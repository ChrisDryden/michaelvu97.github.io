<head>
    <style type = "text/css">
      #paper, #paper:focus {
        background-color:#fff;
        color:#666666;
        font-family:courier;
        font-size:56px;
        padding:25px;
        outline: 0px solid transparent;
        white-space: pre;
        height: auto; 
        box-shadow: 0px 0px 8px #ccc;
        border-radius: 5px;
      }
      h1 {
        font-family: courier;
        text-align: center;
        color:#333;
      }
    </style>
    <script type="text/javascript">

      /*
       * Key-value pairs for the ids of the sound files.
       */
      function getSoundId (input) {
        if (input === 'KEY_1') return '0Bwi7BfuvEZXsVElDQ0J1dlRvRWc';
        if (input === 'KEY_2') return '0Bwi7BfuvEZXsbHMzcTFJWVd1Rm8';
        if (input === 'KEY_3') return '0Bwi7BfuvEZXsNWpnSFRGbFhxeXc';
        if (input === 'KEY_4') return '0Bwi7BfuvEZXsR1ROYzlNZW9IUVk';
        // TODO: get a better linebreak noise, that actually sounds like the slide.
        if (input === 'LINEBREAK') return '0Bwi7BfuvEZXsQnNWbG1wVnVydjQ';
        if (input === 'SPACEBAR_1') return '0Bwi7BfuvEZXsOFM0T29LeFpyWWM';
        if (input === 'SPACEBAR_2') return '0Bwi7BfuvEZXsSk1PLVlpdVhVemM';

        //ID NOT FOUND
        return 'ERROR_ID_NOT_FOUND';
      }

      /*
       * Preloads all the sounds into the audio players.
       */
      function loadSounds() {

        var names = ['KEY_1', 'KEY_2', 'KEY_3', 'KEY_4', 'LINEBREAK', 'SPACEBAR_1', 'SPACEBAR_2'];

        for (var i = 0; i < names.length; i++) {
          document.getElementById(names[i]).src = 'http://docs.google.com/uc?export=open&id=' + getSoundId(names[i]);    
        }

        document.addEventListener('keydown', keyPress);
      }

      // Handles the sound for a key press.
      function keyPress(e) {
        /*
         * The audio player elements for each keypress.
         * TODO: ADD A QUEUE SO THAT ONLY ONE SOUND PLAYS, 
         */
        
        if (e.keyCode == 9) {

          // Override default tab-key functionality to insert whitespace.
          e.preventDefault();
          addTab();

          // Now it  will go to thespace keypress sound.
        } 

        if (e.keyCode == 13) {

          // On linebreak/enter
          var linebreakAudio = document.getElementById('LINEBREAK');

          /*
           * Override the playing check, since there's only one player for 
           * this.
           */
          play(linebreakAudio);

        } else if (e.keyCode == 32 || e.keyCode == 9) {

          // On spacebar or tab
          var spacebarAudio1 = document.getElementById('SPACEBAR_1');
          var spacebarAudio2 = document.getElementById('SPACEBAR_2');

          /*
           * Two buffers so that the sound doesn't get overwritten often.
           */
          if (!isPlaying(spacebarAudio1))
            play(spacebarAudio1);
          else
            play(spacebarAudio2);

        } else {

          // Every other key.
          var key1Audio = document.getElementById('KEY_1');
          var key2Audio = document.getElementById('KEY_2');
          var key3Audio = document.getElementById('KEY_3');
          var key4Audio = document.getElementById('KEY_4');

          /*
           * Buffered fourfold so that the sounds can flow smoothly and not 
           * get cut off early.
           */
          if (!isPlaying(key1Audio))
            play(key1Audio);
          else if (!isPlaying(key2Audio))
            play(key2Audio);
          else if (!isPlaying(key3Audio))
            play(key3Audio);
          else
            play(key4Audio);

        }
      }

      function addTab() {
        /*
         * Function for overriding adding a tab to the document. Used when
         * overriding the tab input that results in losing focus of the 
         * panel.
         */
        var doc = paper.ownerDocument.defaultView;
        var selection = doc.getSelection();
        var range = selection.getRangeAt(0);
        var tabNode = document.createTextNode('\u00a0\u00a0\u00a0\u00a0');
        range.insertNode(tabNode);
        range.setStartAfter(tabNode);
        range.setEndAfter(tabNode);
        selection.removeAllRanges();
        selection.addRange(range);
      }

      function clearPage() {
        paper.html('');
      }

      function isPlaying(audioPlayer) {
          return !audioPlayer.paused;
      }

      function play(audioPlayer) {
        // Overrides the player and starts from the beginning.
        audioPlayer.currentTime = 0;
        audioPlayer.play();
      }

    </script>

</head>

<body onload="loadSounds()">
  <audio id="KEY_1">
    Your browser does not support this function
  </audio>
  <audio id="KEY_2"></audio>
  <audio id="KEY_4"></audio>
  <audio id="KEY_3"></audio>
  <audio id="LINEBREAK"></audio>
  <audio id="SPACEBAR_1"></audio>
  <audio id="SPACEBAR_2"></audio>
  <h1>Typewriter Simulator</h1>
  <div id="paper" contenteditable onload="loadSounds()">
 
</body>
